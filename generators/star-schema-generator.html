<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Schema Dataset Generator - WORKING VERSION</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
            color: #1e293b;
        }
        
        .header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        
        .button {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(30, 64, 175, 0.3);
        }
        
        .button.download-all {
            background: linear-gradient(135deg, #059669, #10b981);
            font-size: 1.2rem;
            padding: 20px 40px;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚≠ê Star Schema Dataset Generator</h1>
        <p>Enterprise-grade dimensional model for Power BI</p>
    </div>

    <div class="card">
        <h2>üìä Dataset Overview</h2>
        <p>This generator creates a complete star schema with:</p>
        <ul>
            <li><strong>Fact Table:</strong> ~50,000 orders (2020-2024)</li>
            <li><strong>6 Dimensions:</strong> Customer, Product, Geography, Sales Rep, Channel, Date</li>
            <li><strong>Realistic Data:</strong> Seasonality, growth patterns, hierarchies</li>
            <li><strong>Enterprise Ready:</strong> Proper relationships and keys</li>
        </ul>
    </div>

    <div class="card">
        <h2>üìÅ Download Files</h2>
        
        <div style="text-align: center; margin: 30px 0;">
            <button class="button download-all" onclick="downloadAll()">
                üì¶ Download All Files (7 CSV Files)
            </button>
        </div>
        
        <p style="text-align: center; margin-bottom: 20px;">Or download individual files:</p>
        
        <div class="grid">
            <button class="button" onclick="downloadFact()">üìä Fact Orders</button>
            <button class="button" onclick="downloadDate()">üìÖ Date Dimension</button>
            <button class="button" onclick="downloadCustomer()">üë• Customer Dimension</button>
            <button class="button" onclick="downloadProduct()">üì¶ Product Dimension</button>
            <button class="button" onclick="downloadGeography()">üåç Geography Dimension</button>
            <button class="button" onclick="downloadSalesRep()">üë§ Sales Rep Dimension</button>
            <button class="button" onclick="downloadChannel()">üõí Channel Dimension</button>
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        // Global data storage
        let dataGenerated = false;
        let datasets = {};

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 5000);
            }
        }

        function generateAllData() {
            if (dataGenerated) return;
            
            showStatus('üîÑ Generating star schema data...', 'info');
            
            try {
                // Generate Date Dimension (2020-2024)
                datasets.date = [];
                const startDate = new Date('2020-01-01');
                const endDate = new Date('2024-12-31');
                
                for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
                    const currentDate = new Date(date);
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth() + 1;
                    const day = currentDate.getDate();
                    const dayOfWeek = currentDate.getDay();
                    
                    datasets.date.push({
                        Date: currentDate.toISOString().substr(0, 10),
                        Year: year,
                        Quarter: Math.ceil(month / 3),
                        Month: month,
                        MonthName: currentDate.toLocaleString('default', { month: 'long' }),
                        FiscalYear: month >= 2 ? year + 1 : year,
                        FiscalQuarter: month >= 2 ? Math.ceil((month - 1) / 3) : 4,
                        IsWeekend: dayOfWeek === 0 || dayOfWeek === 6,
                        IsBusinessDay: dayOfWeek !== 0 && dayOfWeek !== 6
                    });
                }

                // Generate Customer Dimension
                datasets.customer = [];
                const industries = ['Technology', 'Healthcare', 'Financial Services', 'Manufacturing', 'Retail', 'Energy'];
                const sizes = ['Enterprise', 'Mid-Market', 'SMB'];
                const tiers = ['Platinum', 'Gold', 'Silver', 'Bronze'];
                
                for (let i = 1; i <= 500; i++) {
                    const industry = industries[Math.floor(Math.random() * industries.length)];
                    const size = sizes[Math.floor(Math.random() * sizes.length)];
                    const tier = tiers[Math.floor(Math.random() * tiers.length)];
                    
                    datasets.customer.push({
                        CustomerID: `CUST-${String(i).padStart(4, '0')}`,
                        CustomerName: `${industry} Corp ${i}`,
                        Industry: industry,
                        CompanySize: size,
                        CustomerTier: tier
                    });
                }

                // Generate Product Dimension
                datasets.product = [];
                const categories = [
                    { name: 'Network Infrastructure', base: 120000, products: ['Fiber Systems', 'Routers', 'Switches'] },
                    { name: 'Cloud Solutions', base: 65000, products: ['Compute', 'Storage', 'Platform'] },
                    { name: 'Security Platforms', base: 95000, products: ['Firewall', 'Identity', 'Monitoring'] },
                    { name: 'Analytics Software', base: 45000, products: ['BI Tools', 'Data Warehouse', 'Reporting'] }
                ];
                
                let productId = 1;
                categories.forEach(category => {
                    category.products.forEach(productLine => {
                        for (let i = 1; i <= 5; i++) {
                            datasets.product.push({
                                ProductID: `PROD-${String(productId).padStart(4, '0')}`,
                                ProductName: `${productLine} v${i}.0`,
                                ProductLine: productLine,
                                Category: category.name,
                                BasePrice: category.base
                            });
                            productId++;
                        }
                    });
                });

                // Generate Geography Dimension
                datasets.geography = [];
                const regions = [
                    { name: 'North America', countries: [
                        { name: 'United States', cities: ['New York', 'Los Angeles', 'Chicago', 'Houston'] },
                        { name: 'Canada', cities: ['Toronto', 'Vancouver', 'Montreal'] }
                    ]},
                    { name: 'Europe', countries: [
                        { name: 'United Kingdom', cities: ['London', 'Manchester', 'Birmingham'] },
                        { name: 'Germany', cities: ['Berlin', 'Munich', 'Hamburg'] }
                    ]},
                    { name: 'Asia Pacific', countries: [
                        { name: 'Japan', cities: ['Tokyo', 'Osaka', 'Nagoya'] },
                        { name: 'Australia', cities: ['Sydney', 'Melbourne', 'Brisbane'] }
                    ]}
                ];
                
                let geoId = 1;
                regions.forEach(region => {
                    region.countries.forEach(country => {
                        country.cities.forEach(city => {
                            datasets.geography.push({
                                GeographyID: `GEO-${String(geoId).padStart(4, '0')}`,
                                City: city,
                                Country: country.name,
                                Region: region.name
                            });
                            geoId++;
                        });
                    });
                });

                // Generate Sales Rep Dimension
                datasets.salesrep = [];
                const repNames = ['John Smith', 'Sarah Johnson', 'Michael Brown', 'Emily Davis', 'David Wilson'];
                const teams = ['Enterprise Sales', 'Mid-Market Sales', 'Channel Sales'];
                
                for (let i = 1; i <= 25; i++) {
                    const name = repNames[Math.floor(Math.random() * repNames.length)] + ` ${i}`;
                    const team = teams[Math.floor(Math.random() * teams.length)];
                    
                    datasets.salesrep.push({
                        SalesRepID: `REP-${String(i).padStart(3, '0')}`,
                        RepName: name,
                        RepTeam: team,
                        RepRegion: regions[Math.floor(Math.random() * regions.length)].name
                    });
                }

                // Generate Channel Dimension
                datasets.channel = [
                    { ChannelID: 'CHN-001', ChannelName: 'Direct Sales', ChannelType: 'Direct', CostPercent: 0.15 },
                    { ChannelID: 'CHN-002', ChannelName: 'Partner Channel', ChannelType: 'Indirect', CostPercent: 0.22 },
                    { ChannelID: 'CHN-003', ChannelName: 'Online Store', ChannelType: 'Digital', CostPercent: 0.08 },
                    { ChannelID: 'CHN-004', ChannelName: 'Reseller Network', ChannelType: 'Indirect', CostPercent: 0.25 }
                ];

                // Generate Fact Table
                datasets.fact = [];
                let orderId = 1;

                for (let year = 2020; year <= 2024; year++) {
                    for (let month = 1; month <= 12; month++) {
                        const ordersThisMonth = 800 + (year - 2020) * 100 + Math.floor(Math.random() * 200);
                        
                        for (let i = 0; i < ordersThisMonth; i++) {
                            const customer = datasets.customer[Math.floor(Math.random() * datasets.customer.length)];
                            const product = datasets.product[Math.floor(Math.random() * datasets.product.length)];
                            const geography = datasets.geography[Math.floor(Math.random() * datasets.geography.length)];
                            const salesRep = datasets.salesrep[Math.floor(Math.random() * datasets.salesrep.length)];
                            const channel = datasets.channel[Math.floor(Math.random() * datasets.channel.length)];

                            const orderDate = new Date(year, month - 1, Math.floor(Math.random() * 28) + 1);
                            
                            const sizeMultiplier = {
                                'Enterprise': 2.5,
                                'Mid-Market': 1.0,
                                'SMB': 0.4
                            }[customer.CompanySize];

                            const quantity = Math.floor(Math.random() * 10) + 1;
                            const unitPrice = Math.round(product.BasePrice * sizeMultiplier * (0.8 + Math.random() * 0.4) / quantity);
                            const revenue = unitPrice * quantity;
                            const cost = Math.round(revenue * (0.3 + channel.CostPercent));
                            const grossProfit = revenue - cost;

                            datasets.fact.push({
                                OrderID: `ORD-${String(orderId).padStart(7, '0')}`,
                                OrderDate: orderDate.toISOString().substr(0, 10),
                                CustomerID: customer.CustomerID,
                                ProductID: product.ProductID,
                                GeographyID: geography.GeographyID,
                                SalesRepID: salesRep.SalesRepID,
                                ChannelID: channel.ChannelID,
                                Quantity: quantity,
                                UnitPrice: unitPrice,
                                Revenue: revenue,
                                Cost: cost,
                                GrossProfit: grossProfit,
                                GrossMarginPercent: Math.round((grossProfit / revenue) * 10000) / 100
                            });

                            orderId++;
                        }
                    }
                }

                dataGenerated = true;
                showStatus('‚úÖ Star schema data generated successfully!', 'success');
                
            } catch (error) {
                showStatus('‚ùå Error generating data: ' + error.message, 'error');
            }
        }

        function arrayToCsv(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => {
                    const value = row[header];
                    if (typeof value === 'string' && value.includes(',')) {
                        return `"${value}"`;
                    }
                    return value;
                }).join(','))
            ].join('\n');
            
            return csvContent;
        }

        function downloadCsv(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                return true;
            }
            return false;
        }

        function downloadFact() {
            generateAllData();
            const csv = arrayToCsv(datasets.fact);
            const success = downloadCsv(csv, 'Fact_Orders.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Fact_Orders.csv (${datasets.fact.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadDate() {
            generateAllData();
            const csv = arrayToCsv(datasets.date);
            const success = downloadCsv(csv, 'Dim_Date.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Dim_Date.csv (${datasets.date.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadCustomer() {
            generateAllData();
            const csv = arrayToCsv(datasets.customer);
            const success = downloadCsv(csv, 'Dim_Customer.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Dim_Customer.csv (${datasets.customer.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadProduct() {
            generateAllData();
            const csv = arrayToCsv(datasets.product);
            const success = downloadCsv(csv, 'Dim_Product.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Dim_Product.csv (${datasets.product.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadGeography() {
            generateAllData();
            const csv = arrayToCsv(datasets.geography);
            const success = downloadCsv(csv, 'Dim_Geography.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Dim_Geography.csv (${datasets.geography.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadSalesRep() {
            generateAllData();
            const csv = arrayToCsv(datasets.salesrep);
            const success = downloadCsv(csv, 'Dim_SalesRep.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Dim_SalesRep.csv (${datasets.salesrep.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadChannel() {
            generateAllData();
            const csv = arrayToCsv(datasets.channel);
            const success = downloadCsv(csv, 'Dim_Channel.csv');
            if (success) {
                showStatus(`‚úÖ Downloaded Dim_Channel.csv (${datasets.channel.length.toLocaleString()} records)`, 'success');
            }
        }

        function downloadAll() {
            generateAllData();
            
            showStatus('üîÑ Downloading all files...', 'info');
            
            const files = [
                { data: datasets.fact, name: 'Fact_Orders.csv' },
                { data: datasets.date, name: 'Dim_Date.csv' },
                { data: datasets.customer, name: 'Dim_Customer.csv' },
                { data: datasets.product, name: 'Dim_Product.csv' },
                { data: datasets.geography, name: 'Dim_Geography.csv' },
                { data: datasets.salesrep, name: 'Dim_SalesRep.csv' },
                { data: datasets.channel, name: 'Dim_Channel.csv' }
            ];

            let downloadCount = 0;
            
            files.forEach((file, index) => {
                setTimeout(() => {
                    const csv = arrayToCsv(file.data);
                    const success = downloadCsv(csv, file.name);
                    if (success) downloadCount++;
                    
                    if (index === files.length - 1) {
                        setTimeout(() => {
                            showStatus(`üéâ Downloaded ${downloadCount} of ${files.length} files successfully!`, 'success');
                        }, 500);
                    }
                }, index * 300);
            });
        }
    </script>
</body>
</html>
